(window.webpackJsonp=window.webpackJsonp||[]).push([[126],{471:function(e,t,s){"use strict";s.r(t);var n=s(0),a=Object(n.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("p",[e._v("WebSocket 是基于TCP的协议，可以用来做即时通信；同时基于HTTP协议也是基于TCP协议的，WebSocket依赖于HTTP连接。")]),e._v(" "),t("h1",{attrs:{id:"常见问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常见问题"}},[e._v("#")]),e._v(" 常见问题")]),e._v(" "),t("ol",[t("li",[e._v("WebSocket 依赖于HTTP连接，那么它如何从连接的HTTP协议转化为WebSocket协议的？")])]),e._v(" "),t("p",[e._v("每个WebSocket 连接都始于一个HTTP请求。具体来说，WebSocket协议在第一次握手连接时，通过HTTP协议在传送WebSocket支持的版本号、协议的字版本号、原始地址、主机地址等等一些列字段给服务器端：")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("GET /chat http/1.1\nHost: server.example.com\nUpgrade: websocket\nConnection: Upgrade\nSec-WebSocket-key: dGhlIHNhbXBsZSBub25jZQ==\nSec-WebSocket-Protocol: chat, superchat\norigin: http://example.com\nSec-WebSocket-Version: 13\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br")])]),t("p",[e._v("Upgrade、Connention字段：这个是WebSocket的核心，告诉Apache、Nginx等服务器，发起的请求要用WebSocket协议，让服务器找到对应的协议处理；")]),e._v(" "),t("p",[e._v("Sec-WebSocket-key字段，它是一个base64 encode的值，这个是浏览器随机生成的，发送给服务器用以验证是否为WebSocket协议通信；")]),e._v(" "),t("p",[e._v("Sec-WebSocket-Protocol字段：是用户定义的字符串，用来区分同一个url下，不同的服务所需要的协议。")]),e._v(" "),t("p",[e._v("Sec-WebSocket-Version：告诉服务器所使用的WebSocket Draft(协议版本)。")]),e._v(" "),t("p",[e._v("然后服务器会返回下列信息，表示已经接收到请求，成功建立WebSocket：")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("HTTP/1.1 101 Switching Protocols\nUpgrade: websocket\nConnection: Upgrade\nSec-WebSocket-Accept: HSmrc0sMlYUkAGmm5OPpG2HaGWk=\nSec-WebSocket-Protocol: chat\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br")])]),t("p",[e._v("其中Upgrade、Connection字段告诉客户端，已经成功切换协议到WebSocket；")]),e._v(" "),t("p",[e._v("Sec-WebSocket-Accept：经过服务器确认，并且加密过后的Sec-WebSocket-key；用以客户端确认校验；")]),e._v(" "),t("p",[e._v("Sec-WebSocket-Protocol：最终使用的协议。")]),e._v(" "),t("p",[e._v("至此，HTTP完成了它所有的工作，接下来就是完全按照WebSocket协议进行了。")]),e._v(" "),t("ol",{attrs:{start:"2"}},[t("li",[e._v("WebSocket为什么要依赖于HTTP协议的连接？")])])])}),[],!1,null,null,null);t.default=a.exports}}]);